<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Financial Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/dashboard.css">
</head>
<body>
    <div class="dashboard-page-wrapper">
        <h1 class="dashboard-title">Dashboard</h1>

        <div class="table-container">
            <div class="dashboard-table-wrapper">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Accounts</th>
                            <% summaries.forEach(summary => { %>
                                <th data-date="<%= summary.end_date %>">
                                    <%= new Date(summary.end_date).toISOString().split('T')[0] %>
                                    <button class="delete-year-button" data-entry-id="<%= summary.id %>">Delete</button>
                                </th>
                            <% }); %>
                            <th>
                                <input 
                                    type="date" 
                                    class="new-year-input" 
                                    placeholder="Select a reporting date"
                                    onchange="addNewYearColumn(event)"
                                />
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Assets Section -->
                        <tr class="section-row">
                            <td colspan="<%= summaries.length + 2 %>" class="section-title">Assets</td>
                        </tr>
                        <tr>
                            <td>Total Assets</td>
                            <% summaries.forEach(() => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        class="financial-input"
                                        placeholder="Enter total assets"
                                    />
                                </td>
                            <% }); %>
                            <td>
                                <input type="text" class="financial-input" disabled placeholder="New entry" />
                            </td>
                        </tr>
                        <% entryMap.filter(entry => entry.category === 'Assets').forEach(entry => { %>
                        <tr>
                            <td>
                                <%= entry.label %>
                                <button class="delete-item-button" data-label-id="<%= entry.id %>" style="float: right;">D</button>
                            </td>
                            <% summaries.forEach(() => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        value="<%= entry.value %>"
                                        data-label-id="<%= entry.id %>"
                                        class="financial-input"
                                    />
                                </td>
                            <% }); %>
                        </tr>
                        <% }); %>
                        <tr>
                            <td colspan="<%= summaries.length + 2 %>">
                                <button class="add-item-button asset-button">Add a New Asset</button>
                            </td>
                        </tr>

                        <!-- Repeat Similar Structure for Debts -->
                        <tr class="section-row">
                            <td colspan="<%= summaries.length + 2 %>" class="section-title">Debts</td>
                        </tr>
                        <tr>
                            <td>Total Debts</td>
                            <% summaries.forEach(() => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        class="financial-input debt-input"
                                        placeholder="Enter total debts"
                                    />
                                </td>
                            <% }); %>
                            <td>
                                <input type="text" class="financial-input" disabled placeholder="New entry" />
                            </td>
                        </tr>
                        <% entryMap.filter(entry => entry.category === 'Debts').forEach(entry => { %>
                        <tr>
                            <td>
                                <%= entry.label %>
                                <button class="delete-item-button" data-label-id="<%= entry.id %>" style="float: right;">D</button>
                            </td>
                            <% summaries.forEach(() => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        value="<%= entry.value %>"
                                        data-label-id="<%= entry.id %>"
                                        class="financial-input debt-input"
                                    />
                                </td>
                            <% }); %>
                        </tr>
                        <% }); %>
                        <tr>
                            <td colspan="<%= summaries.length + 2 %>">
                                <button class="add-item-button debt-button">Add a New Debt</button>
                            </td>
                        </tr>

                        <!-- Repeat for Expenses -->
                        <tr class="section-row">
                            <td colspan="<%= summaries.length + 2 %>" class="section-title">Unnecessary Expenses</td>
                        </tr>
                        <tr>
                            <td>Total Expenses</td>
                            <% summaries.forEach(() => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        class="financial-input expense-input"
                                        placeholder="Enter total expenses"
                                    />
                                </td>
                            <% }); %>
                            <td>
                                <input type="text" class="financial-input" disabled placeholder="New entry" />
                            </td>
                        </tr>
                        <% entryMap.filter(entry => entry.category === 'Expenses').forEach(entry => { %>
                        <tr>
                            <td>
                                <%= entry.label %>
                                <button class="delete-item-button" data-label-id="<%= entry.id %>" style="float: right;">D</button>
                            </td>
                            <% summaries.forEach(() => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        value="<%= entry.value %>"
                                        data-label-id="<%= entry.id %>"
                                        class="financial-input expense-input"
                                    />
                                </td>
                            <% }); %>
                        </tr>
                        <% }); %>
                        <tr>
                            <td colspan="<%= summaries.length + 2 %>">
                                <button class="add-item-button expense-button">Add a New Expense</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Gold API Placeholder -->
                <script>
                    function addNewYearColumn(event) {
                        const date = event.target.value;
                        if (!date) return;
                        alert(`Retrieve gold rate for ${date}`); // Placeholder for gold API call
                        // Implement gold API logic here for offline mode
                    }
                </script>
            </div>
        </div>
    </div>
</body>
</html>
