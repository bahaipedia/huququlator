<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/dashboard.css">
</head>
<body>
    <%- include('partials/sidebar', { loggedIn: loggedIn }) %>
    <div class="dashboard-page-wrapper">
        <h1 class="dashboard-title">Dashboard</h1>

        <!-- Table Container -->
        <div class="table-container">
            <!-- Dashboard Table -->
            <div class="dashboard-table-wrapper">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Accounts</th>
                            <% summaries.forEach(summary => { %>
                                <th><%= new Date(summary.end_date).toLocaleDateString() %></th>
                            <% }); %>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Assets Section -->
                        <tr class="section-row">
                            <td colspan="<%= summaries.length + 1 %>" class="section-title">Assets</td>
                        </tr>
                        <% entries.filter(entry => entry.category === 'Assets').forEach(entry => { %>
                        <tr>
                            <td><%= entry.label %></td>
                            <% summaries.forEach(summary => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        value="<%= entry.value %>" 
                                        data-id="<%= entry.id %>" 
                                        class="asset-input"
                                    />
                                </td>
                            <% }); %>
                        </tr>
                        <% }); %>
                        <tr>
                            <td colspan="<%= summaries.length + 1 %>">
                                <button class="add-item-button asset-button">Add a New Asset</button>
                            </td>
                        </tr>

                        <!-- Debts Section -->
                        <tr class="section-row">
                            <td colspan="<%= summaries.length + 1 %>" class="section-title">Debts</td>
                        </tr>
                        <% entries.filter(entry => entry.category === 'Debts').forEach(entry => { %>
                        <tr>
                            <td><%= entry.label %></td>
                            <% summaries.forEach(summary => { %>
                                <td>
                                    (<input 
                                        type="text" 
                                        value="<%= entry.value %>" 
                                        data-id="<%= entry.id %>" 
                                        class="debt-input"
                                    />)
                                </td>
                            <% }); %>
                        </tr>
                        <% }); %>
                        <tr>
                            <td colspan="<%= summaries.length + 1 %>">
                                <button class="add-item-button debt-button">Add a New Debt</button>
                            </td>
                        </tr>

                        <!-- Expenses Section -->
                        <tr class="section-row">
                            <td colspan="<%= summaries.length + 1 %>" class="section-title">Expenses</td>
                        </tr>
                        <% entries.filter(entry => entry.category === 'Expenses').forEach(entry => { %>
                        <tr>
                            <td><%= entry.label %></td>
                            <% summaries.forEach(summary => { %>
                                <td>
                                    <input 
                                        type="text" 
                                        value="<%= entry.value %>" 
                                        data-id="<%= entry.id %>" 
                                        class="expense-input"
                                    />
                                </td>
                            <% }); %>
                        </tr>
                        <% }); %>
                        <tr>
                            <td colspan="<%= summaries.length + 1 %>">
                                <button class="add-item-button expense-button">Add a New Expense</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Add Year Button -->
                <div class="add-year-button-wrapper">
                    <button class="add-year-button">Add a New Year</button>
                </div>
            </div>

            <!-- Summary Table -->
            <table class="summary-table" data-summary-id="<%= summaries[summaries.length - 1]?.id %>">
                <thead>
                    <tr>
                        <th>Summary</th>
                        <% summaries.forEach(summary => { %>
                            <th><%= new Date(summary.end_date).toLocaleDateString() %></th>
                        <% }); %>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Total Assets:</td>
                        <% summaries.forEach(summary => { %>
                            <td class="total-assets"><%= summary.total_assets ? parseFloat(summary.total_assets).toFixed(2) : '0.00' %></td>
                        <% }); %>
                    </tr>
                    <tr>
                        <td>Total Debts:</td>
                        <% summaries.forEach(summary => { %>
                            <td class="total-debts">(<%= summary.total_debts ? parseFloat(summary.total_debts).toFixed(2) : '0.00' %>)</td>
                        <% }); %>
                    </tr>
                    <tr>
                        <td>Unnecessary Expenses:</td>
                        <% summaries.forEach(summary => { %>
                            <td class="unnecessary-expenses"><%= summary.unnecessary_expenses ? parseFloat(summary.unnecessary_expenses).toFixed(2) : '0.00' %></td>
                        <% }); %>
                    </tr>
                    <tr>
                        <td>Wealth already taxed:</td>
                        <% summaries.forEach(summary => { %>
                            <td>
                                <input 
                                    type="text" 
                                    value="<%= summary.wealth_already_taxed.toFixed(2) %>" 
                                    class="wealth-already-taxed"
                                />
                            </td>
                        <% }); %>
                    </tr>
                    <tr>
                        <td>Gold Rate:</td>
                        <% summaries.forEach(summary => { %>
                            <td class="gold-rate"><%= summary.gold_rate.toFixed(2) %></td>
                        <% }); %>
                    </tr>
                    <tr>
                        <td>Huquq Payments Made:</td>
                        <% summaries.forEach(summary => { %>
                            <td>
                                <input 
                                    type="text" 
                                    value="<%= summary.huquq_payments_made.toFixed(2) %>" 
                                    class="huquq-payments-made"
                                />
                            </td>
                        <% }); %>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script src="/dashboard.js"></script>
</body>
</html>
